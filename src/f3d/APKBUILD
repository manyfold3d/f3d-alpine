# Contributor: Saijin-Naib <Saijin-Naib_package-maintenance@outlook.com>
# Maintainer: Saijin-Naib <Saijin-Naib_package-maintenance@outlook.com>
pkgname=f3d
pkgver=3.4.1
pkgrel=1
pkgdesc="Fast and minimalist 3D viewer."
url="https://f3d.app"
arch="all"
license="BSD-3-Clause"
makedepends="alembic-dev assimp-dev cmake freeimage-dev git git-lfs opencascade-dev openexr-dev samurai vtk-dev"
subpackages="$pkgname-bash-completion $pkgname-dev $pkgname-doc $pkgname-fish-completion $pkgname-zsh-completion"
source="
	$pkgname-$pkgver.tar.gz::https://github.com/f3d-app/f3d/archive/refs/tags/v$pkgver.tar.gz
	egl-detection.patch
"
builddir="$srcdir/$pkgname-$pkgver/"
options="!check" #No testsuite in githash version
build() {
	if [ "$CBUILD" != "$CHOST" ]; then
		local crossopts="-DCMAKE_SYSTEM_NAME=Linux -DCMAKE_HOST_SYSTEM_NAME=Linux"
	fi
	cmake -B build -G Ninja \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DBUILD_SHARED_LIBS=ON \
		-DCMAKE_BUILD_TYPE=None \
		-DF3D_MODULE_EXR=ON \
		-DF3D_PLUGIN_BUILD_ASSIMP=ON \
		-DF3D_PLUGIN_BUILD_OCCT=ON \
		-DF3D_PLUGIN_BUILD_ALEMBIC=ON \
		-DF3D_PLUGIN_BUILD_VDB=ON \
		$crossopts
	cmake --build build
#-DF3D_PLUGIN_BUILD_DRACO=OFF \
  # Draco is only in testing/edge, and we're building on 3.23
#-DF3D_MODULE_RAYTRACING=OFF \
	#VTK Not Built With, ospray Not Packaged
#-DF3D_PLUGIN_BUILD_USD=OFF \
	#Not Packaged
}

#check() {
#	ctest --test-dir build
#	cmake -DBUILD_TESTING=ON ../src
#	make
#	ctest
#}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
3e78801754430141c00884ae0f34d51bec90c04e2104f79d3a717a0b3d6e4bc81758d96ab1f0a8a91ba084ea4ecea00b621e44f62ed6a355668be7157cc36e76  f3d-3.4.1.tar.gz
"
