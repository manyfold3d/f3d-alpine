# Contributor: Saijin-Naib <Saijin-Naib_package-maintenance@outlook.com>
# Maintainer: Saijin-Naib <Saijin-Naib_package-maintenance@outlook.com>
pkgname=f3d
#pkgver=3.1.0
pkgver=3.2.0_git$_gitdate
_githash="8d2f5be9806f6db4d67686dc8a6351f2ab7cc3b2"
_gitdate="20250705"
pkgrel=0
pkgdesc="Fast and minimalist 3D viewer."
url="https://f3d.app"
arch="all"
license="BSD-3-Clause"
makedepends="alembic-dev assimp-dev cmake draco-dev draco-static freeimage-dev git git-lfs opencascade-dev openexr-dev samurai vtk-dev"
subpackages="$pkgname-bash-completion $pkgname-dev $pkgname-doc $pkgname-fish-completion $pkgname-zsh-completion"
#source="$pkgname-$pkgver.tar.gz::https://github.com/f3d-app/f3d/archive/refs/tags/v$pkgver.tar.gz"
source="$pkgname-$pkgver.tar.gz::https://github.com/f3d-app/f3d/archive/$_githash.tar.gz"
builddir="$srcdir/$pkgname-$_githash/"
options="!check" #No testsuite in githash version
build() {
	if [ "$CBUILD" != "$CHOST" ]; then
		local crossopts="-DCMAKE_SYSTEM_NAME=Linux -DCMAKE_HOST_SYSTEM_NAME=Linux"
	fi
	cmake -B build -G Ninja \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DBUILD_SHARED_LIBS=ON \
		-DCMAKE_BUILD_TYPE=None \
		-DF3D_MODULE_EXR=ON \
		-DF3D_PLUGIN_BUILD_ASSIMP=ON \
		-DF3D_PLUGIN_BUILD_EXODUS=ON \
		-DF3D_PLUGIN_BUILD_OCCT=ON \
		-DF3D_PLUGIN_BUILD_ALEMBIC=ON \
		-DF3D_PLUGIN_BUILD_DRACO=ON \
		$crossopts
	cmake --build build
#-DF3D_MODULE_RAYTRACING=OFF \
	#VTK Not Built With, ospray Not Packaged
#-DF3D_MODULE_EXTERNAL_RENDERING=OFF \
	#VTK Not Built With
#-DF3D_PLUGIN_BUILD_USD=OFF \
	#Not Packaged
#-DF3D_PLUGIN_BUILD_VDB=OFF \
	#VTK Not Built With
}

#check() {
#	ctest --test-dir build
#	cmake -DBUILD_TESTING=ON ../src
#	make
#	ctest
#}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
158a18e181f93358ea034df3a468e2a594d6b155e05a33dbb1adb947d60d3f5d52bf021ef837914a9cfe39bb0cf2fb48177159af06485ce3ad4c6c2f88079784  f3d-3.2.0_git.tar.gz
"
